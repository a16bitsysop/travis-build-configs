os: linux
dist: focal
language: minimal

before_install:
  - |
      mkdir -p ~/.docker/cli-plugins
      echo '{' > ~/.docker/config.json
      echo '"experimental":"enabled"' >> ~/.docker/config.json
      echo '}' >> ~/.docker/config.json
      cat ~/.docker/config.json
  - wget -o ~/.docker/cli-plugins/docker-buildx https://github.com/docker/buildx/releases/download/v0.4.1/buildx-v0.4.1.linux-amd64
  - chmod a+x ~/.docker/cli-plugins/docker-buildx
  - sudo service docker restart
  - docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
  - docker buildx create --use
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

#addons:
#  apt:
#    sources:
#    - sourceline: 'deb https://download.docker.com/linux/ubuntu bionic stable'
#      key_url: 'https://download.docker.com/linux/ubuntu/gpg'
#    packages:
#    - docker-ce-cli
